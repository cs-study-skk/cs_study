# 인터럽트 (Interrupt)

## 📌 인터럽트란?
- CPU는 한 순간에 하나의 일밖에 처리할 수 없다.
- 그렇기 때문에 **어떤 일을 처리하는 도중**에 **우선 순위가 급한 일을 먼저 처리해야 할 때** 대처할 수 있는 매커니즘을 **인터럽트**라고 한다.
- 즉, **CPU가 특정 기능을 수행하는 도중 우선 순위가 급한 일이 발생했다거나 어떠한 오류가 발생해 급하게 다른 일을 처리하고자 할 때 사용하는 것**이다.

<br>

> **인터럽트가 필요한 이유**
> 인터럽트는 컴퓨터 시스템의 필수적 요소로 **시스템의 안정과 효율성을 유지하는 데 중요한 역할**을 한다.
> <br> **외부 이벤트 처리**: 주변 장치나 다른 하드웨어 장치가 CPU에게 신호를 보내야 하는 경우, **외부 이벤트는 즉시 처리**되어야 한다. 이런 경우 인터럽트가 필요하다.
> <br> **다중 작업 처리**: 운영 체제는 다중 작업을 지원하기 때문에 **여러 프로세스나 스레드가 동시에 실행**된다. 이러한 작업들은 **CPU의 시간을 공유**하기 때문에 인터럽트를 통해 **여러 작업 간의 전환이 가능**하게 하며, **각 작업이 적절한 시점에서 CPU를 점유**할 수 있도록 한다.
> <br> **에러 및 예외 처리**: 프로그램을 실행 중 에러나 예외 상황이 발생할 수 있다. 이때 인터럽트는 **CPU에게 해당 문제를 처리하도록 알릴 수 있다.**
> <br> **시스템 리소스 관리**: 정기적으로 발생하는 타이머 인터럽트와 같이 인터럽트는 **시스템 리소스를 효율적으로 관리**하는 데 도움이 된다. 

<br>

## 📌 인터럽트 종류
### 외부 인터럽트
- **입출력 장치, 타이밍 장치, 전원 등 외부적인 요인에 의해서 발생하는 인터럽트**
- 전원 이상 인터럽트 (Power fail interrupt)
  - 정전이나 전원이 이상 있는 경우
- 기계 착오 인터럽트 (Machine check interrupt)
  - CPU의 기능적인 오류
- 외부 신호 인터럽트 (External interrupt)
  - 타이머에 의한 인터럽트. 자원이 할당된 시간이 다 끝난 경우
  - 키보드로 인터럽트 키를 누른 경우 (대표적인 예로는 `Control + Alt + Delete`)
  - 외부장치로부터 인터럽트 요청이 있는 경우
- 입출력 인터럽트 (I/O Interrupt)
  - 입출력 장치가 데이터 전송을 요구하거나 전송이 끝나 다음 동작이 수행되어야 할 경우
  - 입출력 데이터에 이상이 있는 경우


### 내부 인터럽트
- **잘못된 명령이나 데이터를 사용할 때 발생하는 인터럽트**
- **Trap**이라고 부른다.
- 프로그램 검사 인터럽트 (Program Check Interrupt)
  - Division By Zero: 0으로 나누는 경우
  - Overflow/Underflow
  - 그 외 프로그램 상의 오류나 프로그램에서 함수 등 명령어를 잘못 입력한 경우 발생한 Exception

### 소프트웨어 인터럽트
- **SuperVisor Call**
- 사용자가 프로그램을 실행하거나 감시 프로그램을 호출하는 동작을 수행하는 경우
- 소프트웨어 이용 중 다른 프로세스를 실행시키면 시분할 처리를 위해 자원 할당 등의 동작 수행

<br>

> 하드웨어 인터럽트와 외부 인터럽트, 내부 인터럽트와 소프트웨어 인터럽트는 대체적으로 동일한 의미를 가지지만 약간의 차이가 있다.
> **외부 인터럽트**는 **CPU 외부에서 발생하는 인터럽트**를 의미하고, **하드웨어 인터럽트**는 **하드웨어 동작과 관련된 인터럽트**를 말한다.
> 즉, **외부 인터럽트의 하위 개념이 하드웨어 인터럽트**이다.
> **내부 인터럽트**는 **주로 프로세서 내부에서의 예외 상황이나 특정 명령의 실행에 따라 발생하는 인터럽트**이고, **소프트웨어 인터럽트**는 **소프트웨어적 명령에 의해 인위적으로 발생시키는 인터럽트**를 말한다.

<br>

> **✔️ 타이머 인터럽트**
> <br>
> <br>
> ![image](https://github.com/cs-study-skk/cs_study/assets/39427152/2c5ba44b-1018-45c6-b91b-90908ce34333)
> <br>
> <br> 타이머 인터럽트를 발생시키는 장치가 컴퓨터 안에 칩으로 존재한다.
> <br> 해당 칩은 일정한 간격으로 인터럽트를 계속해서 발생시킨다.
> <br> 그렇게 되면 하드웨어에서는 운영 체제에게 인터럽트를 일정한 시간 간격으로 발생시키고
> <br> 운영 체제는 해당 인터럽트를 누적해서 가지고 있게 된다.
> <br> 즉, 프로세스를 교체해야 하는 시기를 하드웨어가 운영 체제에게 알려 주어 일정한 시간 간격으로 프로세스를 교체해야 한다는 걸 인지하게 해 준다.
> <br> 이는 **선점형 스케줄러**에게 필요한 기능이며, **외부 인터럽트 처리 방법**이다.


<br>

## 📌 인터럽트 우선 순위
해당 우선 순위는 일반적인 우선 순위를 말하며 실제 시스템에서는 차이가 있을 수 있다.
1. 전원 이상 (Power Fail): 시스템 전원에 이상이 생겼을 때 발생하는 인터럽트로, 가장 심각한 상황으로 간주되어 보통 가장 높은 우선 순위를 갖는다.
2. 기계 착오 (Machine Check): 하드웨어에서 발생하는 비정상적인 상황으로, CPU나 메모리 등의 하드웨어 오류이다.
3. 외부 신호 (External): 주로 사용자 입력이나 외부 장치에서 발생하는 인터럽트이다.
4. 입출력 (I/O): 입출력 장치와의 통신에서 발생하는 인터럽트로, 완료된 입출력 작업을 처리하기 위해 발생한다.
5. 명령어 잘못: 잘못된 명령어를 실행하려고 할 때 발생하는 인터럽트이다.
6. 프로그램 검사 (Program Check): 프로그램 실행 중에 발생하는 예외적인 상황이나 오류를 나타내는 인터럽트이다.
7. SVC (SuperVisor Call): 사용자 프로그램이 운영 체제의 서비스를 요청할 때 발생하는 인터럽트이다. 이는 일반적으로 운영 체제가 제공하는 시스템 콜을 호출할 때 발생한다.

<br>

## 📌 인터럽트 동작 및 처리 단계
![image](https://github.com/cs-study-skk/cs_study/assets/39427152/4412e322-b7f2-4d58-b01c-09dab9a577a1)
1. 인터럽트 요청
2. CPU가 처리하던 프로세스 중단
3. 현재 실행 중인 프로세스 상태 PCB(Process Control Block)에 저장
4. 인터럽트 원인 식별
5. ISR(Interrupt Service Routine) 처리 -> 발생한 인터럽트의 번호 (IDT)를 확인해 주소 값을 넣음
6. 상태 복구
7. PCB에서 정보 가지고 오기
8. 명령어 수행 -> 이전 중단된 프로세스 명령어 실행을 재개

<br>

> **✔️ IDT (Interrupt Descriptor Table)**
> <br> 미리 정의되어 있는 인터럽트들의 번호와 실행 코드를 가리키는 주소들이 저장되어 있는 테이블이다.
> <br> 컴퓨터 부팅 시 운영 체제가 IDT에 인터럽트들을 기록하고, 
> <br> 인터럽트가 발생하면 IDT를 확인해 Interrupt 번호에 해당하는 함수를 호출하여 인터럽트를 처리하게 된다.

<br>

> **✔️ 프로세스 제어 블록(Process Control Block, PCB)**
> <br>
>![image](https://github.com/cs-study-skk/cs_study/assets/39427152/1a643472-e832-4b99-9b5c-e509c036694c)
> <br>
> <br> 운영 체제가 각 프로세스를 관리하기 위해 사용하는 데이터 구조.
> <br> 프로세스 상태, 프로세스 카운터(다음 실행할 명령어의 주소), 레지스터 상태, 프로그램 식별자, 스케줄링 정보, 메모리 관리 정보, 입출력 상태 정보, 프로세스 계정 정보
> <br> 위의 정보들을 저장하는 데 사용된다.
> <br> 프로세스마다 하나의 PCB가 할당되고, 프로세스가 생성되면 PCB가 초기화되고 종료되면 PCB가 제거된다.

<br>

## 📌 인터럽트 구성 요소 
1. 발생원(Source) : 인터럽트를 발생시킨 소스 또는 하드웨어 장치가 무엇인지. 즉, 누가 인터럽트를 발생시켰는지.
2. 우선순위(Priority) : 여러 인터럽트 요청이 동시에 발생할 때, 어떤 인터럽트를 우선하여 처리할지. 높은 우선 순위를 가진 인터럽트는 먼저 처리되고, 일반적으로 중요한 인터럽트에 높은 우선 순위가 할당된다.
3. 인터럽트 벡터(Interrupt Vector) : 각 인터럽트에 대한 서비스 루틴(Interrupt Service Routine, ISR)의 시작 번지. CPU는 인터럽트가 발생했을 때 해당 인터럽트 벡터를 통해 ISR 위치를 찾고 실행한다.


참고 블로그: 
[참고](https://velog.io/@hyun0310woo/7.-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C)
[참고](https://nice-engineer.tistory.com/entry/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8Interrupt)
[참고](https://whatisthenext.tistory.com/147)
[참고](https://baebalja.tistory.com/354)
[참고](https://velog.io/@yuseogi0218/Interrupt-%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8)
[참고](https://medium.com/@lazypanda43/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8-%EC%A2%85%EB%A5%98%EC%99%80-%EC%B2%98%EB%A6%AC%EA%B3%BC%EC%A0%95%EA%B3%BC-%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84-c95c26909472)
[참고](https://binworld.kr/10)

